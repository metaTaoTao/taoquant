# 实盘交易检查清单

**⚠️ 重要：请务必按照此清单逐步测试，不要跳过任何步骤！**

## 📋 测试流程（建议至少运行24-48小时）

### 阶段1: Dry Run 基础测试（至少2-4小时）

**目标**: 验证程序能正常运行，策略逻辑正确

```bash
# 1. Dry Run模式（不下单）
python algorithms/taogrid/run_bitget_live.py \
    --symbol BTCUSDT \
    --dry-run \
    --config-file config_bitget_live.json
```

**检查项**:
- [ ] 程序能正常启动，无报错
- [ ] 日志输出正常，能看到网格订单计划
- [ ] 能正常获取实时K线数据
- [ ] 网格计算逻辑合理（买卖价格、数量）
- [ ] 日志中能看到 `[DRY_RUN_ORDERS]` 信息

**观察重点**:
- 网格价格是否在support/resistance范围内
- 订单数量是否合理
- 是否有异常错误信息

---

### 阶段2: Dry Run 模拟成交测试（至少24小时）

**目标**: 验证完整的交易流程（模拟成交）

**配置**: 在 `config_bitget_live.json` 中确保：
```json
{
  "execution": {
    "simulate_fills_in_dry_run": true,  // 开启模拟成交
    ...
  }
}
```

```bash
# 运行带模拟成交的Dry Run
python algorithms/taogrid/run_bitget_live.py \
    --symbol BTCUSDT \
    --dry-run \
    --config-file config_bitget_live.json
```

**检查项**:
- [ ] 能模拟订单成交（看到 `[DRY_RUN_FILL]` 日志）
- [ ] 纸面组合状态更新正确
- [ ] 网格配对逻辑正确
- [ ] 风控逻辑生效（如达到阈值会限制下单）

**观察重点**:
- 模拟的PnL是否合理
- 持仓管理是否正确
- 是否有异常的风险控制触发

---

### 阶段3: 小资金实盘测试（至少48小时）

**⚠️ 只有在阶段1和阶段2都通过后，才进行此阶段！**

**准备工作**:
1. **使用子账户**（强烈推荐）
   - 创建独立的子账户
   - 转入少量资金（如$100-500）
   - 使用子账户的API密钥

2. **调整配置参数**:
   ```json
   {
     "strategy": {
       "initial_cash": 100.0,  // 小资金
       "risk_budget_pct": 0.3,  // 降低风险预算
       ...
     },
     "execution": {
       "active_buy_levels": 3,  // 减少活跃层级（更保守）
       ...
     }
   }
   ```

3. **移除 `--dry-run` 参数**:
```bash
python algorithms/taogrid/run_bitget_live.py \
    --symbol BTCUSDT \
    --config-file config_live_small.json  # 使用小资金配置
    # 注意：不再使用 --dry-run
```

**检查项**:
- [ ] 订单能正常下单到交易所
- [ ] 订单状态能正确跟踪
- [ ] 成交后持仓更新正确
- [ ] 日志中的订单ID能在交易所查证
- [ ] 实时PnL计算正确

**观察重点**:
- 订单执行速度
- 成交价格是否合理
- 账户余额变化
- 是否有异常订单被拒绝

**监控频率**: 前2小时每15分钟检查一次，之后每小时检查一次

---

### 阶段4: 逐步增加资金（可选）

只有在阶段3稳定运行至少48小时后，才考虑：

1. **小幅增加资金**（如$500 → $1000）
2. **观察24小时**
3. **确认无问题后再继续增加**

---

## ⚠️ 风险控制措施

### 实盘前必须确认

- [ ] **API密钥权限正确**
  - 只有交易权限，不要给提现权限
  - 使用子账户隔离风险

- [ ] **资金管理**
  - 使用你愿意承担全部损失的资金
  - 不要使用全部资产
  - 建议从$100-500开始

- [ ] **监控设置**
  - 设置余额告警
  - 设置异常订单告警（可选）
  - 定期检查日志

- [ ] **紧急停止方案**
  - 知道如何快速停止程序（Ctrl+C）
  - 知道如何在交易所手动取消所有订单
  - 知道如何关闭API密钥

- [ ] **配置参数验证**
  - `support/resistance` 是否合理
  - `leverage` 是否符合你的风险承受能力
  - `risk_budget_pct` 是否保守（建议≤0.5）

---

## 🔍 常见问题排查

### Dry Run阶段

**问题**: 看不到任何日志输出
- 检查API密钥是否正确
- 检查网络连接
- 查看是否有错误信息

**问题**: 网格价格不合理
- 检查 `support/resistance` 设置
- 检查当前价格是否在范围内
- 查看 `initial_cash` 是否太小

**问题**: 模拟成交没有触发
- 确认 `simulate_fills_in_dry_run: true`
- 检查价格是否真的触及了网格层级

### 实盘阶段

**问题**: 订单被拒绝
- 检查账户余额是否充足
- 检查订单价格是否合理（不能超过涨跌停）
- 检查API权限是否正确

**问题**: 订单执行缓慢
- 这是正常的（limit orders需要等待价格触发）
- 如果急需成交，可以使用market orders（但不推荐）

**问题**: 持仓与预期不符
- 检查是否有手动交易
- 查看日志中的订单成交记录
- 检查是否有程序重启导致的持仓同步问题

---

## 📊 监控指标

### 实时监控（运行中）

- **日志输出**: 是否有错误信息
- **订单状态**: 挂单数量、成交数量
- **账户余额**: 是否异常变化
- **持仓数量**: 是否在合理范围内
- **PnL**: 实时盈亏情况

### 每日检查（实盘后）

- **总交易次数**: 是否符合预期
- **平均盈亏**: 是否合理
- **最大回撤**: 是否在可接受范围
- **滑点情况**: 实际成交价格与预期差异
- **异常订单**: 是否有被拒绝的订单

---

## ✅ 总结

**必须完成的测试顺序**:
1. ✅ Dry Run基础测试（2-4小时）
2. ✅ Dry Run模拟成交测试（24小时）
3. ✅ 小资金实盘测试（48小时）
4. ✅ 逐步增加资金（可选）

**绝对不要**:
- ❌ 跳过Dry Run直接实盘
- ❌ 使用大资金首次测试
- ❌ 忽视日志中的错误信息
- ❌ 在未充分测试的情况下长时间无人值守运行

**记住**: 测试的时间成本远低于资金损失的风险！

---

最后更新: 2025-01-XX

