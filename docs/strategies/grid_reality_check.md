# 网格策略实际vs理论：数据真相

> **核心发现**: 1min的实际单笔回报(0.095%)远低于min_return目标(0.5%)

---

## 📊 实际交易数据

### 1min K线的残酷真相

```
总交易数: 1065笔
平均回报: 0.095%  ⚠️ 仅为min_return(0.5%)的19%!
中位数回报: 0.099%

回报分布:
  > 1.0%: 0笔   ❌ 一笔都没有！
  > 0.5%: 0笔   ❌ 一笔都没达到min_return！
  > 0.2%: 155笔 (14.6%)
  0-0.2%: 694笔 (65.2%)  ⚠️ 绝大部分是微薄利润
  < 0%: 216笔 (20.3%)   ⚠️ 1/5是亏损

胜率: 79.72%
最大盈利: 0.338%
最大亏损: -0.816%
```

### 15min K线的健康表现

```
总交易数: 268笔
平均回报: 0.722%  ✅ 超过min_return(0.5%)的144%!
中位数回报: 0.705%

回报分布:
  > 1.0%: 44笔 (16.4%)   ✅ 有超额回报
  > 0.5%: 216笔 (80.6%)  ✅ 绝大部分达标
  > 0.2%: 267笔 (99.6%)  ✅ 几乎全部健康
  0-0.2%: 0笔           ✅ 没有微薄利润
  < 0%: 1笔 (0.4%)      ✅ 几乎没有亏损

胜率: 99.63%
最大盈利: 1.444%
最大亏损: -0.405%
```

---

## ❓ 为什么1min没有一笔交易达到0.5%目标？

### 理论 vs 实际

**理论（网格设计）**:
```
Grid spacing计算确保：
往返净利润 >= min_return = 0.5%

例如：
买入level: $116,000
卖出level: $116,600
价格差: 0.52%
扣除成本0.2% (仅考虑maker fee)
净利润: 0.32%  ⚠️ 但这已经低于0.5%了！
```

等等，我发现问题了！让我重新检查grid spacing的计算...

**实际问题**:

1. **网格spacing < min_return要求**

   网格spacing是基于ATR和volatility_k动态计算的：
   ```python
   spacing_pct = calculate_grid_spacing(
       atr=atr,
       min_return=0.005,
       maker_fee=0.001,
       volatility_k=0.6,
   )

   # 实际计算公式（简化版）:
   # spacing ≈ (min_return + 2×maker_fee) × volatility_k
   # 但这个会根据ATR调整，可能 < min_return
   ```

   在低波动期，spacing可能压缩到 < 0.5%！

2. **VectorBT的交易不是完美往返**

   VectorBT基于entry/exit signals执行：
   ```
   理想网格往返:
   买入@$116,000 → 等待 → 卖出@$116,600 = 0.5%利润

   实际VectorBT交易:
   Entry signal@$116,050 → Exit signal@$116,180 = 0.11%利润

   为什么差距这么大？
   - Entry可能没在精确的grid level
   - Exit可能因为其他条件触发，未到对面level
   - 实际获利距离 << grid spacing
   ```

3. **1min噪音导致早退出**

   ```
   10:00 - 价格$116,000，触发BUY signal
   10:01 - 买入@$116,020（有滑点）
   10:02 - 价格涨到$116,150
   10:03 - 价格回落到$116,100
   10:04 - 触发某个EXIT条件（可能是止损、时间、或反向信号）
   10:05 - 卖出@$116,080

   利润: ($116,080 - $116,020) / $116,020 = 0.05%
   扣除成本0.15%后 = -0.1% 亏损！
   ```

### 数据验证

**1min的0-0.2%微利交易占65.2%**

这些交易的特征：
- 实际价格移动很小（0.1%-0.2%）
- 没有完成完整的grid往返
- 扣除成本后几乎没有净利润
- 累积起来也无法覆盖亏损交易的损失

**15min的80.6%交易 > 0.5%**

这些交易的特征：
- 价格移动足够大（平均0.72%）
- 接近或完成了grid往返
- 扣除成本后仍有健康利润
- 少数交易甚至 > 1.0%

---

## 🎯 关键洞察

### 1. min_return是"目标"不是"保证"

```
min_return = 0.5%  ← 这是grid spacing计算的输入参数
                   不是每笔交易的保证回报！

实际单笔回报取决于：
- 实际entry和exit价格
- 市场波动是否足够
- 是否完成完整往返
```

### 2. 1min的实际回报仅为理论的19%

```
理论min_return: 0.5%
实际平均回报: 0.095%

差距: 0.5% / 0.095% = 5.26倍！
```

**为什么差距这么大？**
- Grid spacing可能 < 0.5%（低波动期）
- VectorBT交易不是完美往返
- 1min噪音导致早退出
- 滑点0.05%额外侵蚀

### 3. 15min的实际回报超过理论的144%

```
理论min_return: 1.0% (15min我们提高了min_return)
实际平均回报: 0.722%

虽然略低，但非常接近！
而且80.6%的交易 > 0.5%（1min的min_return）
```

**为什么15min更接近理论？**
- 价格波动足够大
- 往返完成率高
- 噪音少，退出更合理
- 滑点占比小

---

## 💰 成本影响再分析

### 1min的成本占比

```
平均回报: 0.095%
总成本: 0.15% (commission 0.1% + slippage 0.05%)

成本占比: 0.15% / 0.095% = 158%  ⚠️

这意味着成本是利润的1.58倍！
```

但等等，如果成本 > 利润，为什么还能盈利$109？

**解释**:
- return_pct已经是扣除了commission和slippage的**净回报**
- 所以0.095%是已经扣完成本的
- 但这个回报太微薄了，导致总利润很低

### 15min的成本占比

```
平均回报: 0.722%
总成本: 0.15%

成本占比: 0.15% / 0.722% = 21%  ✅

成本仅占利润的21%，健康！
```

---

## 📉 回到你的问题

### 你问：min_return=0.5%已包含fee，交易越多应该越赚对吧？

**答案**: 理论上对，但有3个前提：

1. **每笔交易实际回报 >= min_return (0.5%)**
   - 1min: ❌ 实际仅0.095%，差5倍
   - 15min: ✅ 实际0.722%，超目标

2. **胜率接近100%**
   - 1min: ❌ 仅79.72%，20%亏损
   - 15min: ✅ 99.63%，几乎全盈利

3. **完成完整往返**
   - 1min: ❌ 大部分是不完整往返
   - 15min: ✅ 绝大部分完整往返

### 为什么1min不满足这些前提？

**根本原因**: **1min市场噪音太大**

```
真实价格趋势: $116,000 → $117,500 (上涨1.3%)

1min看到的:
$116,000 → $116,100 → $115,950 → $116,200 → $116,050 → ...
          ↑ 买入    ↑ 止损?   ↑ 又买入  ↑ 又止损?

结果：频繁交易，大部分是噪音，利润微薄，成本高

15min看到的:
$116,000 → $116,500 → $117,000 → $117,500
          ↑ 卖L1    ↑ 卖L2    ↑ 卖L3

结果：少量交易，捕捉趋势，利润健康，成本低
```

---

## ✅ 最终结论

### 你的理论逻辑100%正确

**IF**:
- ✅ 每笔交易都盈利 >= min_return
- ✅ 胜率100%
- ✅ 完成完整往返

**THEN**: 交易越多，利润越大 ✅

### 但现实是

**1min**:
- ❌ 平均利润0.095% << 0.5%目标
- ❌ 胜率仅79.72%
- ❌ 不完整往返占多数
- **结果**: 1065笔交易仅赚$109

**15min**:
- ✅ 平均利润0.722% ≈ min_return
- ✅ 胜率99.63%
- ✅ 完整往返占多数
- **结果**: 268笔交易赚$820 (7.5倍！)

### 数学证明

```
理论(你的逻辑):
利润 = 交易数 × 单笔净利 × 胜率

如果单笔净利 >= min_return且胜率高:
  更多交易 = 更高利润 ✅

实际(1min):
利润 = 1065 × 0.095% × 79.72% = $109
       ↑      ↑ 太低!    ↑ 不够高

实际(15min):
利润 = 268 × 0.722% × 99.63% = $820
       ↑     ↑ 健康!   ↑ 极高!
```

**关键**: 不是交易数的问题，是**单笔利润质量**和**胜率**的问题！

---

## 🔧 建议

### 如果你坚持1min，需要:

1. **调整grid spacing计算**
   ```python
   # 当前
   maker_fee = 0.001  # 0.1%

   # 修改为
   total_cost = 0.0015  # 0.15% (包含slippage)
   # 或者提高min_return到1.0%以上
   ```

2. **降低slippage假设**
   ```python
   # 如果实盘使用maker orders
   slippage = 0.0001  # 0.01%
   # 或者
   slippage = 0.0  # 假设全部是limit orders成交
   ```

3. **添加noise filter**
   - 只在价格移动 > 某阈值时才交易
   - 避免微小波动触发

### 但最简单的方法: 用15min ✅

已验证：
- ✅ 单笔利润健康(0.722%)
- ✅ 胜率极高(99.63%)
- ✅ 总利润7.5倍于1min
- ✅ 风险更低(回撤-1.50% vs -2.62%)
- ✅ 夏普比率优秀(4.53 vs 0.16)

---

**最后更新**: 2025-12-13
**数据来源**: 实际回测交易记录
**结论**: 15min > 1min，理论正确但需要满足前提条件

